(function(n){"function"===typeof bootstrap?bootstrap("promise",n):"object"===typeof exports?module.exports=n():"function"===typeof define&&define.amd?define(n):"undefined"!==typeof ses?ses.ok()&&(ses.makeQ=n):Q=n()})(function(){function n(a){return function(){return U.apply(a,arguments)}}function G(a,b){if(x&&b.stack&&"object"===typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(H)){for(var e=[],c=b;c;c=c.source)c.stack&&e.unshift(c.stack);e.unshift(a.stack);for(var e=e.join("\n"+H+"\n").split("\n"),
c=[],d=0;d<e.length;++d){var k=e[d],l;if(l=I(k)){var J=l[1];l=l[0]===K&&J>=V&&J<=W}else l=!1;l||(l=k,l=-1!==l.indexOf("(module.js:")||-1!==l.indexOf("(node.js:"));l||!k||c.push(k)}e=c.join("\n");a.stack=e}}function I(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b||(b=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a)))return[b[1],Number(b[2])];if(a=/.*@(.+):(\d+)$/.exec(a))return[a[1],Number(a[2])]}function L(){if(x)try{throw Error();}catch(a){var b=a.stack.split("\n"),b=0<b[0].indexOf("@")?b[1]:b[2];if(b=
I(b))return K=b[0],b[1]}}function c(a){return r(a)?a:M(a)?X(a):A(a)}function m(){function a(a){g=a;k.source=a;y(b,function(b,e){p(function(){a.promiseDispatch.apply(a,e)})},void 0);e=b=void 0}var b=[],e=[],g,h=C(m.prototype),k=C(d.prototype);k.promiseDispatch=function(a,c,d){var k=f(arguments);b?(b.push(k),"when"===c&&d[1]&&e.push(d[1])):p(function(){g.promiseDispatch.apply(g,k)})};k.valueOf=function(){if(b)return k;var a=N(g);r(a)&&(g=a);return a};k.inspect=function(){return g?g.inspect():{state:"pending"}};
if(c.longStackSupport&&x)try{throw Error();}catch(l){k.stack=l.stack.substring(l.stack.indexOf("\n")+1)}h.promise=k;h.resolve=function(b){g||a(c(b))};h.fulfill=function(b){g||a(A(b))};h.reject=function(b){g||a(q(b))};h.notify=function(a){g||y(e,function(b,e){p(function(){e(a)})},void 0)};return h}function t(a){if("function"!==typeof a)throw new TypeError("resolver must be a function.");var b=m();try{a(b.resolve,b.reject,b.notify)}catch(e){b.reject(e)}return b.promise}function O(a){return t(function(b,
e){for(var g=0,d=a.length;g<d;g++)c(a[g]).then(b,e)})}function d(a,b,e){void 0===b&&(b=function(a){return q(Error("Promise does not support operation: "+a))});void 0===e&&(e=function(){return{state:"unknown"}});var c=C(d.prototype);c.promiseDispatch=function(e,d,h){var B;try{B=a[d]?a[d].apply(c,h):b.call(c,d,h)}catch(f){B=q(f)}e&&e(B)};if(c.inspect=e){var h=e();"rejected"===h.state&&(c.exception=h.reason);c.valueOf=function(){var a=e();return"pending"===a.state||"rejected"===a.state?c:a.value}}return c}
function s(a,b,e,g){return c(a).then(b,e,g)}function N(a){if(r(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function r(a){return a===Object(a)&&"function"===typeof a.promiseDispatch&&"function"===typeof a.inspect}function M(a){return a===Object(a)&&"function"===typeof a.then}function D(){v.length=0;z.length=0;w||(w=!0)}function Y(a,b){w&&(z.push(a),b&&"undefined"!==typeof b.stack?v.push(b.stack):v.push("(no stack) "+b))}function q(a){var b=d({when:function(b){if(b&&w){var c=
Z(z,this);-1!==c&&(z.splice(c,1),v.splice(c,1))}return b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});Y(b,a);return b}function A(a){return d({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return $(a)}},void 0,function(){return{state:"fulfilled",value:a}})}
function X(a){var b=m();p(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}});return b.promise}function P(a,b,e){return c(a).spread(b,e)}function R(a,b,e){return c(a).dispatch(b,e)}function u(a){return s(a,function(a){var c=0,d=m();y(a,function(h,k,l){var f;r(k)&&"fulfilled"===(f=k.inspect()).state?a[l]=f.value:(++c,s(k,function(h){a[l]=h;0===--c&&d.resolve(a)},d.reject,function(a){d.notify({index:l,value:a})}))},void 0);0===c&&d.resolve(a);return d.promise})}function S(a){return s(a,
function(a){a=E(a,c);return s(u(E(a,function(a){return s(a,T,T)})),function(){return a})})}var x=!1;try{throw Error();}catch(aa){x=!!aa.stack}var V=L(),K,T=function(){},p=function(){function a(){for(;b.next;){b=b.next;var c=b.task;b.task=void 0;var e=b.domain;e&&(b.domain=void 0,e.enter());try{c()}catch(h){if(k)throw e&&e.exit(),setTimeout(a,0),e&&e.enter(),h;setTimeout(function(){throw h;},0)}e&&e.exit()}d=!1}var b={task:void 0,next:null},c=b,d=!1,h=void 0,k=!1;p=function(a){c=c.next={task:a,domain:k&&
process.domain,next:null};d||(d=!0,h())};if("undefined"!==typeof process&&process.nextTick)k=!0,h=function(){process.nextTick(a)};else if("function"===typeof setImmediate)h="undefined"!==typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!==typeof MessageChannel){var l=new MessageChannel;l.port1.onmessage=function(){h=f;l.port1.onmessage=a;a()};var f=function(){l.port2.postMessage(0)},h=function(){setTimeout(a,0);f()}}else h=function(){setTimeout(a,0)};return p}(),
U=Function.call,f=n(Array.prototype.slice),y=n(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length){do{if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError;}while(1)}for(;c<d;c++)c in this&&(b=a(b,this[c],c));return b}),Z=n(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),E=n(Array.prototype.map||function(a,b){var c=this,d=[];y(c,function(h,k,l){d.push(a.call(b,k,l,c))},void 0);return d}),C=Object.create||
function(a){function b(){}b.prototype=a;return new b},ba=n(Object.prototype.hasOwnProperty),$=Object.keys||function(a){var b=[],c;for(c in a)ba(a,c)&&b.push(c);return b},ca=n(Object.prototype.toString),F;F="undefined"!==typeof ReturnValue?ReturnValue:function(a){this.value=a};var H="From previous event:";c.resolve=c;c.nextTick=p;c.longStackSupport=!1;c.defer=m;m.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):2<arguments.length?a.resolve(f(arguments,1)):a.resolve(c)}};
c.Promise=t;c.promise=t;t.race=O;t.all=u;t.reject=q;t.resolve=c;c.passByCopy=function(a){return a};d.prototype.passByCopy=function(){return this};c.join=function(a,b){return c(a).join(b)};d.prototype.join=function(a){return c([this,a]).spread(function(a,c){if(a===c)return a;throw Error("Can't join: not the same: "+a+" "+c);})};c.race=O;d.prototype.race=function(){return this.then(c.race)};c.makePromise=d;d.prototype.toString=function(){return"[object Promise]"};d.prototype.then=function(a,b,e){function d(b){try{return"function"===
typeof a?a(b):b}catch(c){return q(c)}}function h(a){if("function"===typeof b){G(a,k);try{return b(a)}catch(c){return q(c)}}return q(a)}var k=this,l=m(),f=!1;p(function(){k.promiseDispatch(function(a){f||(f=!0,l.resolve(d(a)))},"when",[function(a){f||(f=!0,l.resolve(h(a)))}])});k.promiseDispatch(void 0,"when",[void 0,function(a){var b,d=!1;try{b="function"===typeof e?e(a):a}catch(g){if(d=!0,c.onerror)c.onerror(g);else throw g;}d||l.notify(b)}]);return l.promise};c.when=s;d.prototype.thenResolve=function(a){return this.then(function(){return a})};
c.thenResolve=function(a,b){return c(a).thenResolve(b)};d.prototype.thenReject=function(a){return this.then(function(){throw a;})};c.thenReject=function(a,b){return c(a).thenReject(b)};c.nearer=N;c.isPromise=r;c.isPromiseAlike=M;c.isPending=function(a){return r(a)&&"pending"===a.inspect().state};d.prototype.isPending=function(){return"pending"===this.inspect().state};c.isFulfilled=function(a){return!r(a)||"fulfilled"===a.inspect().state};d.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state};
c.isRejected=function(a){return r(a)&&"rejected"===a.inspect().state};d.prototype.isRejected=function(){return"rejected"===this.inspect().state};var v=[],z=[],w=!0;c.resetUnhandledRejections=D;c.getUnhandledReasons=function(){return v.slice()};c.stopUnhandledRejectionTracking=function(){D();w=!1};D();c.reject=q;c.fulfill=A;c.master=function(a){return d({isDef:function(){}},function(b,c){return R(a,b,c)},function(){return c(a).inspect()})};c.spread=P;d.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,
b)},b)};c.async=function(a){return function(){function b(a,b){var f;if("undefined"===typeof StopIteration){try{f=e[a](b)}catch(m){return q(m)}return f.done?c(f.value):s(f.value,d,h)}try{f=e[a](b)}catch(n){return"[object StopIteration]"===ca(n)||n instanceof F?c(n.value):q(n)}return s(f,d,h)}var e=a.apply(this,arguments),d=b.bind(b,"next"),h=b.bind(b,"throw");return d()}};c.spawn=function(a){c.done(c.async(a)())};c["return"]=function(a){throw new F(a);};c.promised=function(a){return function(){return P([this,
u(arguments)],function(b,c){return a.apply(b,c)})}};c.dispatch=R;d.prototype.dispatch=function(a,b){var c=this,d=m();p(function(){c.promiseDispatch(d.resolve,a,b)});return d.promise};c.get=function(a,b){return c(a).dispatch("get",[b])};d.prototype.get=function(a){return this.dispatch("get",[a])};c.set=function(a,b,d){return c(a).dispatch("set",[b,d])};d.prototype.set=function(a,b){return this.dispatch("set",[a,b])};c.del=c["delete"]=function(a,b){return c(a).dispatch("delete",[b])};d.prototype.del=
d.prototype["delete"]=function(a){return this.dispatch("delete",[a])};c.mapply=c.post=function(a,b,d){return c(a).dispatch("post",[b,d])};d.prototype.mapply=d.prototype.post=function(a,b){return this.dispatch("post",[a,b])};c.send=c.mcall=c.invoke=function(a,b){return c(a).dispatch("post",[b,f(arguments,2)])};d.prototype.send=d.prototype.mcall=d.prototype.invoke=function(a){return this.dispatch("post",[a,f(arguments,1)])};c.fapply=function(a,b){return c(a).dispatch("apply",[void 0,b])};d.prototype.fapply=
function(a){return this.dispatch("apply",[void 0,a])};c["try"]=c.fcall=function(a){return c(a).dispatch("apply",[void 0,f(arguments,1)])};d.prototype.fcall=function(){return this.dispatch("apply",[void 0,f(arguments)])};c.fbind=function(a){var b=c(a),d=f(arguments,1);return function(){return b.dispatch("apply",[this,d.concat(f(arguments))])}};d.prototype.fbind=function(){var a=this,b=f(arguments);return function(){return a.dispatch("apply",[this,b.concat(f(arguments))])}};c.keys=function(a){return c(a).dispatch("keys",
[])};d.prototype.keys=function(){return this.dispatch("keys",[])};c.all=u;d.prototype.all=function(){return u(this)};c.allResolved=function(a,b,c){return function(){"undefined"!==typeof console&&"function"===typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",Error("").stack);return a.apply(a,arguments)}}(S,"allResolved","allSettled");d.prototype.allResolved=function(){return S(this)};c.allSettled=function(a){return c(a).allSettled()};d.prototype.allSettled=function(){return this.then(function(a){return u(E(a,
function(a){function d(){return a.inspect()}a=c(a);return a.then(d,d)}))})};c.fail=c["catch"]=function(a,b){return c(a).then(void 0,b)};d.prototype.fail=d.prototype["catch"]=function(a){return this.then(void 0,a)};c.progress=function(a,b){return c(a).then(void 0,void 0,b)};d.prototype.progress=function(a){return this.then(void 0,void 0,a)};c.fin=c["finally"]=function(a,b){return c(a)["finally"](b)};d.prototype.fin=d.prototype["finally"]=function(a){a=c(a);return this.then(function(b){return a.fcall().then(function(){return b})},
function(b){return a.fcall().then(function(){throw b;})})};c.done=function(a,b,d,g){return c(a).done(b,d,g)};d.prototype.done=function(a,b,d){var g=function(a){p(function(){G(a,f);if(c.onerror)c.onerror(a);else throw a;})},f=a||b||d?this.then(a,b,d):this;"object"===typeof process&&process&&process.domain&&(g=process.domain.bind(g));f.then(void 0,g)};c.timeout=function(a,b,d){return c(a).timeout(b,d)};d.prototype.timeout=function(a,b){var c=m(),d=setTimeout(function(){b&&"string"!==typeof b||(b=Error(b||
"Timed out after "+a+" ms"),b.code="ETIMEDOUT");c.reject(b)},a);this.then(function(a){clearTimeout(d);c.resolve(a)},function(a){clearTimeout(d);c.reject(a)},c.notify);return c.promise};c.delay=function(a,b){void 0===b&&(b=a,a=void 0);return c(a).delay(b)};d.prototype.delay=function(a){return this.then(function(b){var c=m();setTimeout(function(){c.resolve(b)},a);return c.promise})};c.nfapply=function(a,b){return c(a).nfapply(b)};d.prototype.nfapply=function(a){var b=m();a=f(a);a.push(b.makeNodeResolver());
this.fapply(a).fail(b.reject);return b.promise};c.nfcall=function(a){var b=f(arguments,1);return c(a).nfapply(b)};d.prototype.nfcall=function(){var a=f(arguments),b=m();a.push(b.makeNodeResolver());this.fapply(a).fail(b.reject);return b.promise};c.nfbind=c.denodeify=function(a){var b=f(arguments,1);return function(){var d=b.concat(f(arguments)),g=m();d.push(g.makeNodeResolver());c(a).fapply(d).fail(g.reject);return g.promise}};d.prototype.nfbind=d.prototype.denodeify=function(){var a=f(arguments);
a.unshift(this);return c.denodeify.apply(void 0,a)};c.nbind=function(a,b){var d=f(arguments,2);return function(){var g=d.concat(f(arguments)),h=m();g.push(h.makeNodeResolver());c(function(){return a.apply(b,arguments)}).fapply(g).fail(h.reject);return h.promise}};d.prototype.nbind=function(){var a=f(arguments,0);a.unshift(this);return c.nbind.apply(void 0,a)};c.nmapply=c.npost=function(a,b,d){return c(a).npost(b,d)};d.prototype.nmapply=d.prototype.npost=function(a,b){var c=f(b||[]),d=m();c.push(d.makeNodeResolver());
this.dispatch("post",[a,c]).fail(d.reject);return d.promise};c.nsend=c.nmcall=c.ninvoke=function(a,b){var d=f(arguments,2),g=m();d.push(g.makeNodeResolver());c(a).dispatch("post",[b,d]).fail(g.reject);return g.promise};d.prototype.nsend=d.prototype.nmcall=d.prototype.ninvoke=function(a){var b=f(arguments,1),c=m();b.push(c.makeNodeResolver());this.dispatch("post",[a,b]).fail(c.reject);return c.promise};c.nodeify=function(a,b){return c(a).nodeify(b)};d.prototype.nodeify=function(a){if(a)this.then(function(b){p(function(){a(null,
b)})},function(b){p(function(){a(b)})});else return this};var W=L();return c});