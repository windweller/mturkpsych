alertify.set({buttonFocus:"none"});alertify.set({delay:1E4});
var global_access=function($,window,loc,alertify){var baseHostName=window.location.origin;var mTurkURIPromise=mTurkURIretrieve();var companyURIPromise=companyURIretrieve();var mTurkIdentity=_establishIdentity();function refresh(){$.removeCookie("countTask");return _establishIdentity()}function restart(){$.removeCookie("commToken");$.removeCookie("countTask");return _establishIdentity()}function _establishIdentity(){return mTurkURIPromise.then(function(mTurkUris){return Q($.ajax({url:mTurkUris.mTurkerGet._2,type:mTurkUris.mTurkerGet._1,
dataType:"JSON"})).then(function(data){if(data.mturkId&&!$.cookie("mturkId")){$.cookie("mturkId",data.mturkId);$("input").prop("disabled",true);$("#MturkId").val($.cookie("mturkId"))}if(!data.mturkId&&$.cookie("mturkId")){var html="<div class='row'><div class='large-12 columns'>"+"<p>We detect that you have already typed in a mTurk ID: <kbd>"+$.cookie("mturkId")+"</kbd></p>"+"<p>If you are the owner of this mTurk ID, click <kbd>Cancel</kbd>. You won't have to type it in again."+" However, if you are not, or if you are using a public computer, click <kbd>OK</kbd> so we can successfully proceed."+
" Bare in mind if you click <kbd>OK</kbd>, your progress will be completely lost.</p>"+"<p> You might also be seeing this message if you are here for the second time. If so, you are welcome! Please click <kbd>Cancel</kbd>. </p>"+"</div></div><br>";alertify.confirm(html,function(res){if(res){$.removeCookie("mturkId");$.removeCookie("commToken");$.removeCookie("countTask");loc.reload()}else savemTurkID($.cookie("mturkId"))})}$.cookie("countTask",data.countTask);return data}).fail(function(jqXHR){customAjaxFailureHandle(jqXHR,
mTurkUris.mTurkerGet._2,function(html){var response=html+"<div class='row'><div class='large-12 columns'><div data-alert class='alert-box info radius'> Click 'OK' button, we can solve this problem "+"for you by resetting your COOKIE. However, doing so will eliminate your current progress. <a href='#'' class='close'>&times;</a></div></div></div>";alertify.confirm(response,function(res){if(res){$.removeCookie("commToken");$.removeCookie("countTask");$.removeCookie("mturkId");loc.reload()}})})})})}function mTurkURIretrieve(){return Q($.ajax({url:baseHostName+
"/mturker/help",type:"GET",dataType:"JSON"})).then(function(data){return data}).fail(function(jqXHR){ajaxFailureHandle(jqXHR,baseHostName+"/mturker/help")})}function companyURIretrieve(){return Q($.ajax({url:baseHostName+"/sec/help",type:"GET",dataType:"JSON"})).then(function(data){return data}).fail(function(jqXHR){ajaxFailureHandle(jqXHR,baseHostName+"/sec/help")})}function savemTurkID(id){var data={"mturkid":id};mTurkURIPromise.then(function(uris){Q($.ajax({url:uris.updateMTurkId._2,type:uris.updateMTurkId._1,
datatype:"json",contentType:"application/json; charset=UTF-8",data:JSON.stringify(data)})).fail(function(jqXHR){glo.ajaxFailureHandle(jqXHR,uris.updateMTurkId._2)})})}function _ajaxErrorMsgConstructor(jqXHR,url){var errorMessage="An error has occured from "+url+": "+jqXHR.status+" - "+jqXHR.statusText+". response text: "+jqXHR.responseText;return{txt:errorMessage,html:"<div class='row'><div class='large-12 columns'><h4>An error has occured</h4></div></div>"+"<div class='row'><div class='large-12 columns'><p>Please copy and paste the following information to anie@emory.edu. Thank you!</p></div></div>"+
"<div class='row'><div class='large-12 columns'><p>"+errorMessage+"</p></div></div>"+"<div class='row'><div class='large-12 columns'><p>CommToken: "+$.cookie("commToken")+" <br> CountTask: "+$.cookie("countTask")+"</p></div></div>"}}function ajaxFailureHandle(jqXHR,url){var errorMsgs=_ajaxErrorMsgConstructor(jqXHR,url);console.error(errorMsgs.txt);alertify.alert(errorMsgs.html)}function customAjaxFailureHandle(jqXHR,url,callback){var errorMsgs=_ajaxErrorMsgConstructor(jqXHR,url);console.error(errorMsgs.txt);
callback(errorMsgs.html)}return{mTurkIdentity:mTurkIdentity,mTurkURIPromise:mTurkURIPromise,companyURIPromise:companyURIPromise,savemTurkID:savemTurkID,ajaxFailureHandle:ajaxFailureHandle,customAjaxFailureHandle:customAjaxFailureHandle,refresh:refresh,restart:restart}}(jQuery,window,location,alertify);
var animate=function($,glo,alertify){function taskComplete(progressNum){scrollTop(animateProgressBar,progressNum);collapseAnimate(progressNum,$("#panel-instruction-content"));alertify.success("Hey! A new task has arrived!")}function taskFail(progressNum){scrollTopFail();collapseAnimate(progressNum,$("#panel-instruction-content"))}function animateProgressBar(progressNum){$("#progressBar").animate({"width":progressNum*10+"%"},1E3,"swing");$("#taskDisplay").text(progressNum)}function collapseAnimate(progressNum,
elem){if(progressNum>=1)elem.slideUp("slow")}(function registerAccordian(elem){$("#instruction-header").click(function(e){e.preventDefault();elem.slideToggle("slow")})})($("#panel-instruction-content"));function scrollTop(animateProgressBar,progressNum){var body=$("html, body");body.animate({scrollTop:0},"300","swing",animateProgressBar(progressNum))}function scrollTopFail(){var body=$("html, body");body.animate({scrollTop:0},"300","swing")}return{taskComplete:taskComplete,animateProgressBar:animateProgressBar,
taskFail:taskFail}}(jQuery,global_access,alertify);
var app=function($,glo,animate){var turkerIdentity=glo.mTurkIdentity;var mTurkURIPromise=glo.mTurkURIPromise;var companyURIPromise=glo.companyURIPromise;var fileURIPromise=loadNewDocURL();var baseHostName=window.location.origin;var stateOfDocButtons={readInBrowser:0,downloadFile:0};var textFields={riskFactor:$("#riskFactor"),managementDis:$("#managementDis"),finanState:$("#finanState")};(function init(){updateDocLinks(fileURIPromise);$("#saveMturkId").click(function(event){saveMTurkIdEvent()});$("#MturkId").keydown(function(e){switch(e.keyCode){case 13:saveMTurkIdEvent();
e.preventDefault();break}});$("#unableToComplete").click(function(event){fileURIPromise.then(function(file){var data={companyId:file.id};var newURIPromises=unableToComplete(data);updateDocLinks(newURIPromises);alertify.log("We have swapped the document for you!");animate.taskFail($.cookie("countTask"))})});$("#readInBrowser").click(function(event){stateOfDocButtons.readInBrowser=1});$("#downloadFile").click(function(event){stateOfDocButtons.downloadFile=1});$("#DoneNext").click(function(event){if(!$.cookie("mturkId"))alertify.alert("You must type in your mTurk ID before starting the task.");
else if(textFields.riskFactor.val()!=""&&textFields.managementDis.val()!=""&&textFields.finanState.val()!=""){var lengthOfFirst=textFields.riskFactor.val().length;var lengthOfSecond=textFields.managementDis.val().length;var lengthOfThird=textFields.finanState.val().length;var passedCheck=true;if(lengthOfFirst<=30||lengthOfSecond<=30||lengthOfThird<=30){alertify.alert("The input of those text fields appear to be very short. "+"We can't let this pass our check system. Sorry. If it is the real "+"extraction from the document and we are blocking you, please click "+
"<span class='red'>Unable to Complete</span> button.");passedCheck=false}else if(textFields.riskFactor.val()==textFields.managementDis.val()||textFields.managementDis.val()==textFields.finanState.val()||textFields.riskFactor.val()==textFields.finanState.val()){alertify.alert("The input of those text fields appear to be exactly the same. "+"We can't let this pass our check system. Sorry. If it is the real "+"extraction from the document and we are blocking you, please click "+"<span class='red'>Unable to Complete</span> button.");
passedCheck=false}else if(stateOfDocButtons.downloadFile==0&&stateOfDocButtons.readInBrowser==0){alertify.alert("Please click <span class='red'>Read in your web browser</span>"+" or <span class='red'>Download HTML file</span> first. If this is an error, please email"+"anie@emory.edu");passedCheck=false}if(passedCheck)fileURIPromise.then(function(file){var data={companyId:file.id,riskFactor:textFields.riskFactor.val(),managementDisc:textFields.managementDis.val(),finStateSuppData:textFields.finanState.val()};
var result=sendOutTextArea(data);if($.cookie("countTask")>=9)result.then(function(data){if(data.countTask==10)allComplete("You have completed ten tasks.",data.commToken)})})}else alertify.alert("One or multiple textareas aren't filled."+" If the document is corrupted or doesn't contain all three fields, "+"please click the red button <span class='red'>Unable to Complete</span> "+" at the bottom of the page. ")})})();(function autoFillmTurkId(){turkerIdentity.then(function(data){if(data.mturkId){$("#MturkId").val(data.mturkId);
$("input").prop("disabled",true)}if(data.countTask)animate.animateProgressBar(data.countTask)})})();function updateDocLinks(promise){if(promise)promise.then(function(data){$("#readInBrowser").attr("href",data.htmlURL);$("#downloadFile").attr("href",data.txtURL)})}function saveMTurkIdEvent(){if(!$("#MturkId").val())alertify.alert("<span class='red'>Warning: </span> You must type in your MTurk Id before saving it!");else if($("input").prop("disabled"))alertify.alert("<span class='red'>Warning: </span> Your mTurk ID already exists. If there is any error, please email anie@emory.edu");
else{glo.savemTurkID($("#MturkId").val());$("input").prop("disabled",true);$.cookie("mturkId",$("#MturkId").val())}}function allComplete(customMessage,commToken){alertify.alert("<div class='row'><div class='large-12 columns'><h4>Awesome!</h4></div></div>"+"<div class='row'><div class='large-12 columns'><p>"+customMessage+" Close this page and go back to"+" mTurk now! You have one minute to copy and paste following string to your Amazon mTurk window:</p></div></div>"+"<div class='row text-center'><div class='large-12 columns'><kbd>"+
commToken+"</kbd></div></div><br><br>");glo.restart();$("#alertify-ok").click(function(event){window.location=baseHostName});setTimeout(function(){window.location=baseHostName},6E4)}function rejectMessage(){alertify.alert("<div class='row'><div class='large-12 columns'><h4>Sorry!</h4></div></div>"+"<div class='row'><div class='large-12 columns'><p>We don't have more tasks for you right now! Close this page and go back to"+" mTurk now! We apologize for this inconvenience! </p></div></div><br>");$("#alertify-ok").click(function(event){window.location=
baseHostName});setTimeout(function(){window.location=baseHostName},6E4)}function loadNewDocURL(){if(document.URL.indexOf("turk")>=0)return companyURIPromise.then(function(uris){return Q($.ajax({url:uris.webOneCompany._2,type:uris.webOneCompany._1,datatype:"json",contentType:"application/json; charset=UTF-8"})).then(function(data){return data}).fail(function(jqXHR){if(jqXHR.responseText==JSON.stringify("There is no document fitting requirements left")){var data=glo.refresh();data.then(function(mturker){if(mturker.countTask>=
1){var message="You are the lucky one! It turns out we don't have more documents for you to complete! Congrats!";allComplete(message,$.cookie("commToken"))}else rejectMessage()})}else glo.ajaxFailureHandle(jqXHR,uris.webOneCompany._2)})})}function unableToComplete(data){return companyURIPromise.then(function(uris){return Q($.ajax({url:uris.webUnableToComp._2,type:uris.webUnableToComp._1,datatype:"json",data:JSON.stringify(data),contentType:"application/json; charset=UTF-8"})).then(function(data){return data}).fail(function(jqXHR){glo.ajaxFailureHandle(jqXHR,
uris.webUnableToComp._2)})})}function sendOutTextArea(data){return companyURIPromise.then(function(uris){return Q($.ajax({url:uris.webUpload._2,type:uris.webUpload._1,datatype:"json",contentType:"application/json; charset=UTF-8",data:JSON.stringify(data)})).then(function(data){return oneTaskCompletMTurk()}).fail(function(jqXHR){glo.ajaxFailureHandle(jqXHR,uris.webUpload._2)})})}function oneTaskCompletMTurk(){return mTurkURIPromise.then(function(uris){return Q($.ajax({url:uris.taskComplete._2,type:uris.taskComplete._1,
datatype:"json",contentType:"application/json; charset=UTF-8"})).then(function(data){$.cookie("countTask",data.countTask);animate.taskComplete(data.countTask);textFields.riskFactor.val("");textFields.managementDis.val("");textFields.finanState.val("");return data}).fail(function(jqXHR){glo.ajaxFailureHandle(jqXHR,uris.taskComplete._2)})})}return{fileURIPromise:fileURIPromise}}(jQuery,global_access,animate,alertify);