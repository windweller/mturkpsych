alertify.set({buttonFocus:"none"});alertify.set({delay:1E4});
var global_access=function($,window,loc,alertify){var baseHostName=window.location.origin;var mTurkURIPromise=mTurkURIretrieve();var companyURIPromise=companyURIretrieve();var mTurkIdentity=retrieveIdentity();function retrieveIdentity(){var promiseObj=_establishIdentity();return{"commToken":$.cookie("commToken"),"countTask":$.cookie("countTask"),"promiseObj":promiseObj}}function refresh(){$.removeCookie("countTask");return retrieveIdentity()}function restart(){$.removeCookie("commToken");$.removeCookie("countTask");
return retrieveIdentity()}function _establishIdentity(){return mTurkURIPromise.then(function(mTurkUris){return Q($.ajax({url:mTurkUris.mTurkerGet._2,type:mTurkUris.mTurkerGet._1,dataType:"JSON"})).then(function(data){if(data.mturkId&&!$.cookie("mturkId")){$.cookie("mturkId",data.mturkId);$("input").prop("disabled",true);$("#MturkId").val($.cookie("mturkId"))}if(!data.mturkId&&$.cookie("mturkId")){var html="<div class='row'><div class='large-12 columns'>"+"<p>We detect that you have already typed in a mTurk ID: <kbd>"+
$.cookie("mturkId")+"</kbd></p>"+"<p>If you are the owner of this mTurk ID, click <kbd>Cancel</kbd>. You won't have to type it in again."+" However, if you are not, or if you are using a public computer, click <kbd>OK</kbd> so we can successfully proceed."+"</p>"+"</div></div><br>";alertify.confirm(html,function(res){if(res){$.removeCookie("mturkId");loc.reload()}else savemTurkID($.cookie("mturkId"))})}return data}).fail(function(jqXHR,textStatus,errorThrown){customAjaxFailureHandle(jqXHR,mTurkUris.mTurkerGet._2,
textStatus,errorThrown,function(html){var response=html+"<div class='row'><div class='large-12 columns'><div data-alert class='alert-box info radius'> Click 'OK' button, we can solve this problem "+"for you by resetting your COOKIE. However, doing so will eliminate your current progress. <a href='#'' class='close'>&times;</a></div></div></div>";alertify.confirm(response,function(res){if(res){$.removeCookie("commToken");$.removeCookie("countTask");$.removeCookie("mturkId");loc.reload()}})})})})}function mTurkURIretrieve(){return Q($.ajax({url:baseHostName+
"/mturker/help",type:"GET",dataType:"JSON"})).then(function(data){return data}).fail(function(jqXHR,textStatus,errorThrown){ajaxFailureHandle(jqXHR,baseHostName+"/mturker/help",textStatus,esrrorThrown)})}function companyURIretrieve(){return Q($.ajax({url:baseHostName+"/sec/help",type:"GET",dataType:"JSON"})).then(function(data){return data}).fail(function(jqXHR,textStatus,errorThrown){ajaxFailureHandle(jqXHR,baseHostName+"/sec/help",textStatus,errorThrown)})}function savemTurkID(id){var data={"mturkid":id};
mTurkURIPromise.then(function(uris){Q($.ajax({url:uris.updateMTurkId._2,type:uris.updateMTurkId._1,datatype:"json",contentType:"application/json; charset=UTF-8",data:JSON.stringify(data)})).fail(function(jqXHR,textStatus,errorThrown){glo.ajaxFailureHandle(jqXHR,uris.updateMTurkId._2,textStatus,errorThrown)})})}function _ajaxErrorMsgConstructor(jqXHR,url,textStatus,errorThrown){var errorMessage="An error has occured from "+url+": "+textStatus+" - "+errorThrown+"; response text: "+jqXHR.responseText;
return{txt:errorMessage,html:"<div class='row'><div class='large-12 columns'><h4>An error has occured</h4></div></div>"+"<div class='row'><div class='large-12 columns'><p>Please copy and paste the following information to anie@emory.edu. Thank you!</p></div></div>"+"<div class='row'><div class='large-12 columns'><p>"+errorMessage+"</p></div></div>"+"<div class='row'><div class='large-12 columns'><p>CommToken: "+$.cookie("commToken")+" <br> CountTask: "+$.cookie("countTask")+"</p></div></div>"}}function ajaxFailureHandle(jqXHR,
url,textStatus,errorThrown){var errorMsgs=_ajaxErrorMsgConstructor(jqXHR,url,textStatus,errorThrown);console.error(errorMsgs.txt);alertify.alert(errorMsgs.html)}function customAjaxFailureHandle(jqXHR,url,textStatus,errorThrown,callback){var errorMsgs=_ajaxErrorMsgConstructor(jqXHR,url,textStatus,errorThrown);console.error(errorMsgs.txt);callback(errorMsgs.html)}return{mTurkIdentity:mTurkIdentity,mTurkURIPromise:mTurkURIPromise,companyURIPromise:companyURIPromise,savemTurkID:savemTurkID,ajaxFailureHandle:ajaxFailureHandle,
customAjaxFailureHandle:customAjaxFailureHandle,refresh:refresh,restart:restart}}(jQuery,window,location,alertify);
var animate=function($,glo,alertify){function taskComplete(progressNum){scrollTop(animateProgressBar,progressNum);collapseAnimate(progressNum,$("#panel-instruction-content"));alertify.success("Hey! A new task has arrived!")}function taskFail(progressNum){scrollTopFail();collapseAnimate(progressNum,$("#panel-instruction-content"))}function animateProgressBar(progressNum){$("#progressBar").animate({"width":progressNum*10+"%"},1E3,"swing");$("#taskDisplay").text(progressNum)}function collapseAnimate(progressNum,
elem){if(progressNum>=1)elem.slideUp("slow")}(function registerAccordian(elem){$("#instruction-header").click(function(e){e.preventDefault();elem.slideToggle("slow")})})($("#panel-instruction-content"));function scrollTop(animateProgressBar,progressNum){var body=$("html, body");body.animate({scrollTop:0},"300","swing",animateProgressBar(progressNum))}function scrollTopFail(){var body=$("html, body");body.animate({scrollTop:0},"300","swing")}return{taskComplete:taskComplete,taskFail:taskFail}}(jQuery,
global_access,alertify);
var app=function($,glo,animate){var turkerId=glo.mTurkIdentity;var mTurkURIPromise=glo.mTurkURIPromise;var companyURIPromise=glo.companyURIPromise;var fileURIPromise=loadNewDocURL();var baseHostName=window.location.origin;var textFields={riskFactor:$("#riskFactor"),managementDis:$("#managementDis"),finanState:$("#finanState")};(function init(){updateDocLinks(fileURIPromise);$("#saveMturkId").click(function(event){if(!$("#MturkId").val())alertify.alert("<span class='red'>Warning: </span> You must type in your MTurk Id before saving it!");else if($("input").prop("disabled"))alertify.alert("<span class='red'>Warning: </span> Your mTurk ID already exists. If there is any error, please email anie@emory.edu");
else{glo.savemTurkID($("#MturkId").val());$("input").prop("disabled",true);$.cookie("mturkId",$("#MturkId").val())}});$("#unableToComplete").click(function(event){var newURIPromises=unableToComplete();updateDocLinks(newURIPromises);alertify.log("We have swapped the document for you!");animate.taskFail($.cookie("countTask"))});$("DoneNext").click(function(event){if($.cookie("mturkId"))alertify.alert("You must type in your mTurk ID before starting the task.");else if(textFields.riskFactor.val()!=""&&
textFields.managementDis.val()!=""&&textFields.finanState.val()!=""){var lengthOfFirst=textFields.riskFactor.val().length;var lengthOfSecond=textFields.managementDis.val().length;var lengthOfThird=textFields.finanState.val().length;if(lengthOfFirst<=30||lengthOfSecond<=30||lengthOfThird<=30)alertify.alert("The input of those text fields appear to be very short. "+"We can't let this pass our check system. Sorry. Please click "+"<span class='red'>Unable to Complete</span> button.");var data={riskFactor:textFields.riskFactor.val(),
managementDisc:textFields.managementDis.val(),finStateSuppData:textFields.finanState.val()};sendOutTextArea(data);oneTaskCompletMTurk();if($.cookie("countTask")>=9){var identity=glo.refresh();if(identity.countTask==10){alertify.alert("Awesome! You have completed ten tasks. Close this page and go back to"+" mTurk now! After 10 seconds, we will send you back to starting page.");glo.restart();$("#alertify-ok").click(function(event){window.location=baseHostName});setTimeout(function(){window.location=
baseHostName},1E4)}}animate.taskComplete($.cookie("countTask"))}else alertify.alert("One or multiple textareas aren't filled."+" If the document is corrupted or doesn't contain all three fields, "+"please click the red button <span class='red'>Unable to Complete</span> "+" at the bottom of the page. ")})})();(function autoFillmTurkId(){if($.cookie("mturkId")){$("#MturkId").val($.cookie("mturkId"));$("input").prop("disabled",true)}})();function updateDocLinks(promise){if(promise)promise.then(function(data){$("#readInBrowser").attr("href",
data.htmlURL);$("#downloadFile").attr("href",data.txtURL)})}function loadNewDocURL(){if(document.URL.indexOf("turk")>=0)return companyURIPromise.then(function(uris){return Q($.ajax({url:uris.webOneCompany._2,type:uris.webOneCompany._1,datatype:"json",contentType:"application/json; charset=UTF-8"})).then(function(data){return data}).fail(function(jqXHR,textStatus,errorThrown){glo.ajaxFailureHandle(jqXHR,uris.webOneCompany._2,textStatus,errorThrown)})})}function unableToComplete(data){return companyURIPromise.then(function(uris){return Q($.ajax({url:uris.webUnableToComp._2,
type:uris.webUnableToComp._1,username:$.cookie("mturkId"),password:$.cookie("commToken"),datatype:"json",data:JSON.stringify(data),contentType:"application/json; charset=UTF-8"})).then(function(data){return data}).fail(function(jqXHR,textStatus,errorThrown){glo.ajaxFailureHandle(jqXHR,uris.webUnableToComp._2,textStatus,errorThrown)})})}function sendOutTextArea(data){companyURIPromise.then(function(uris){Q($.ajax({url:uris.webUpload._2,type:uris.webUpload._1,username:$.cookie("mturkId"),password:$.cookie("commToken"),
datatype:"json",contentType:"application/json; charset=UTF-8",data:JSON.stringify(data)})).fail(function(jqXHR,textStatus,errorThrown){glo.ajaxFailureHandle(jqXHR,uris.webUpload._2,textStatus,errorThrown)})})}function oneTaskCompletMTurk(){mTurkURIPromise.then(function(uris){Q($.ajax({url:uris.taskComplete._2,type:uris.taskComplete._1,datatype:"json",contentType:"application/json; charset=UTF-8"})).then(function(data){$.cookie("countTask",data.countTask)}).fail(function(jqXHR,textStatus,errorThrown){glo.ajaxFailureHandle(jqXHR,
uris.taskComplete._2,textStatus,errorThrown)})})}return{fileURIPromise:fileURIPromise}}(jQuery,global_access,animate,alertify);